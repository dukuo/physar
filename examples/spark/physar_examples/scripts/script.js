!function(t){var e={};function s(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,s),i.l=!0,i.exports}s.m=t,s.c=e,s.d=function(t,e,r){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)s.d(r,i,function(e){return t[e]}.bind(null,i));return r},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=4)}([function(t,e){t.exports=require("Time")},function(t,e){t.exports=require("cannon")},function(t,e){t.exports=require("Diagnostics")},function(t,e){t.exports=require("Scene")},function(t,e,s){"use strict";s.r(e);const r=s(3),i=r.root.find("SphereObject"),n=r.root.find("Cube01"),o=r.root.find("plane0"),a=new class{constructor(t){this.Diagnostics=void 0,this.Time=void 0,this.currentInterval=void 0,this.lastInterval=void 0,this.lastTime=void 0,this.fixedTimeStep=1/60,this.maxSubSteps=3,this.timeInterval=5,this.C=void 0,this.worldObjects=[],this.worldConstraints=[],this.defaults={body:{mass:0,radius:1,transform:{rotation:{x:0,y:0,z:0,w:.5},position:{x:0,y:0,z:0},scale:{x:1,y:1,z:1}}},sync:{properties:["position","rotation"],axes:["x","y","z"],rotation:{enabled:!0,allAxis:!0,x:!0,y:!0,z:!0},position:{enabled:!0,allAxis:!0,x:!0,y:!0,z:!0}}},this.initRequiredSparkModules(),this.createCWorld(t)}initRequiredSparkModules(){this.Time=s(0),this.C=s(1),this.Diagnostics=s(2)}createCWorld(t){this.world=new this.C.World,this.world.broadphase=new this.C.NaiveBroadphase,this.world.gravity.set(t.x,t.y,t.z)}beginSync(){this.initialWorldState=this.worldObjects,this.currentInterval=this.Time.setInterval(t=>{if(void 0!==this.lastTime){let e=(t-this.lastTime)/1e3;this.world.step(this.fixedTimeStep,e,this.maxSubSteps),this.objectSync()}this.lastTime=t},this.timeInterval)}objectSync(){this.worldObjects.forEach(t=>{if(t.spark){const e=t.sync,s=e.properties,r=e.axes,i={};t.body.quaternion.toEuler(i),s.forEach(e=>{t.sync[e].enabled&&r.forEach(s=>{if(t.sync[e].allAxis||t.sync[e][s]){const r=`rotation${s.toUpperCase()}`;"position"==e&&(t.spark.transform[s]=t.body[e][s]),"rotation"==e&&(t.spark.transform[r]=i[s])}})})}})}stopSync(){this.currentInterval&&(this.Time.clearInterval(this.currentInterval),this.lastInterval=currentInterval,this.currentInterval=void 0),this.resetWorldState()}getDefaults(t){return t?this.defaults[t]:this.defaults}fillWithDefaults(t){const e=this.getDefaults();return Object.keys(e).forEach(s=>{t.hasOwnProperty(s)||(t[s]=e[s]),Object.keys(e[s]).forEach(r=>{Array.isArray(t[s][r])?e[s][r].forEach(i=>{t[s][r].indexOf(i)<0&&t[s][r].push(e[s][r][i])}):(t[s].hasOwnProperty(r)||(t[s][r]=e[s][r]),"object"!=typeof e[s][r]||Array.isArray(e[s][r])||Object.keys(e[s][r]).forEach(i=>{t[s][r].hasOwnProperty(i)||(t[s][r][i]=e[s][r][i])}))})}),t}resetWorldState(){this.initialWorldState&&this.worldObjects.forEach((t,e)=>{const s=this.initialWorldState[e],r=s.body,i=t.body;if(i.velocity.setZero(),i.initVelocity.setZero(),i.angularVelocity.setZero(),i.initAngularVelocity.setZero(),i.force.setZero(),i.torque.setZero(),i.quaternion=r.quaternion,i.position=r.position,t.spark){const e=t.sync,r=e.properties,i=e.axes,n={};t.body.quaternion.toEuler(n),r.forEach(e=>{t.sync[e].enabled&&i.forEach(r=>{if(t.sync[e].allAxis||t.sync[e][r]){const i=`rotation${r.toUpperCase()}`;"position"==e&&(t.spark.transform[r]=s.spark.transform[r]),"rotation"==e&&(t.spark.transform[i]=s.spark.transform[i])}})})}})}createObject(t,e,s){const{sync:r,body:i}=this.fillWithDefaults(s),{mass:n,radius:o,transform:a}=i,c=a.rotation,d=a.scale,l=a.position,h=new this.C.Vec3(l.x,l.y,l.z),u=new this.C.Quaternion(c.x,c.y,c.z,c.w),f=t=>{switch(t){case"box":return new this.C.Box(new this.C.Vec3(d.x,d.y,d.z));case"sphere":return new this.C.Sphere(o);case"ground":return new this.C.Plane}},p=t=>{const s={mass:n,shape:t,position:h,quaternion:u,angularDamping:.8};return"sphere"==e&&(s.radius=o),"ground"==e&&(s.mass=0),s},y=(t=>{const e=new this.C.Body(p(f(t)));if("ground"==t){const t=-Math.PI/2,s=new this.C.Vec3(1,0,0);e.quaternion.setFromAxisAngle(s,t)}return e})(e);return this.addObjectToPhysicsWorld(y,t,r,"ground"==e)}find(t=0,e){return"object"==t?this.worldObjects.find(t=>t.id==e):"constraint"==t?this.worldConstraints.find(t=>t.id==e):void 0}createConstraint(t,e={}){if(!e.bodyA||!e.bodyB)return;let[s,r,i,n,o,a]=e;const c={pivotA:i,pivotB:n,axisA:o,axisB:a},d=this.find("object",s),l=this.find("object",r);if(!d||!l)return;let h;switch(t){case"point":h=new this.C.PointToPointConstraint(s,i,r,n);break;case"hinge":h=new this.C.HingeConstraint(s,r,c);break;case"conetwist":h=new this.C.ConeTwistConstraint(s,r,c);break;case"lock":h=new this.C.LockConstraint(i,n,{});break;default:return}return this.addConstraint(h,d,l)}addConstraint(t,e,s){if(!e.body||!s.body)return;const r=e.body,i=s.body;this.world.addConstraint(t);const n=btoa(`${r.id}.${i.id}`);return this.worldConstraints.push({id:n,constraint:t,isActive:!0}),n}removeConstraint(t,e=!1){const s=this.find("constraint",t);if(s&&this.world.removeConstraint(s.constraint),e){const t=this.worldConstraints.indexOf(s);this.worldConstraints.splice(t,1)}}pauseConstraint(t){const e=this.find("constraint",t);e&&this.removeConstraint(t,!1);const s=this.worldConstraints.indexOf(e);this.worldConstraints[s].isActive=!1}resumeConstraint(t){const e=this.find("constraint",t),s=e.constraint;if(e&&0==e.isActive){this.world.addConstraint(s);const t=this.worldConstraints.indexOf(e);this.worldConstraints[t].isActive=!0}}log(t){this.Diagnostics.log(t)}addObjectToPhysicsWorld(t,e,s,r){this.world.addBody(t);const i={...this.getDefaults("sync"),...s},n=((t,e)=>{for(e=t="";t++<36;e+=51*t&52?(15^t?8^Math.random()*(20^t?16:4):4).toString(16):"-");return e})(),o={id:n,body:t,spark:e,sync:i,isGround:r};return this.worldObjects.push(o),n}createCMaterial(t){let e=void 0;return null==t&&(e=new this.C.Material),e}start(){this.beginSync()}}({x:0,y:-9.82,z:0});a.createObject(o,"ground",{body:{mass:0,transform:{position:{x:0,y:0,z:0}}}});const c=a.createObject(i,"sphere",{body:{mass:1,radius:.01,transform:{position:{x:0,y:2,z:0}}}}),d=a.createObject(n,"box",{body:{mass:5,transform:{scale:{x:.01,y:.01,z:.01},position:{x:0,y:10,z:0},rotation:{x:.2,y:.8,z:.3,w:0}}}});a.addConstraint("point",c,d);a.start()}]);