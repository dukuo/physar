!function(t){var e={};function r(s){if(e[s])return e[s].exports;var o=e[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,r),o.l=!0,o.exports}r.m=t,r.c=e,r.d=function(t,e,s){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)r.d(s,o,function(e){return t[e]}.bind(null,o));return s},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=4)}([function(t,e){t.exports=require("Time")},function(t,e){t.exports=require("cannon")},function(t,e){t.exports=require("Diagnostics")},function(t,e){t.exports=require("Scene")},function(t,e,r){"use strict";r.r(e);const s=r(3),o=s.root.find("SphereObject"),i=s.root.find("Cube01"),n=s.root.find("plane0"),a=new class{constructor(t){this.Diagnostics=void 0,this.Time=void 0,this.currentInterval=void 0,this.lastInterval=void 0,this.lastTime=void 0,this.fixedTimeStep=1/60,this.maxSubSteps=3,this.timeInterval=5,this.CANNON=void 0,this.worldObjects=[],this.defaults={body:{mass:0,radius:1,transform:{rotation:{x:0,y:0,z:0,w:.5},position:{x:0,y:0,z:0},scale:{x:1,y:1,z:1}}},sync:{properties:["position","rotation"],axes:["x","y","z"],rotation:{enabled:!0,allAxis:!0,x:!0,y:!0,z:!0},position:{enabled:!0,allAxis:!0,x:!0,y:!0,z:!0}}},this.initRequiredSparkModules(),this.createCannonWorld(t)}initRequiredSparkModules(){this.Time=r(0),this.CANNON=r(1),this.Diagnostics=r(2)}createCannonWorld(t){this.world=new this.CANNON.World,this.world.broadphase=new this.CANNON.NaiveBroadphase,this.world.gravity.set(t.x,t.y,t.z)}beginSync(){this.initialWorldState=this.worldObjects,this.currentInterval=this.Time.setInterval(t=>{if(void 0!==this.lastTime){let e=(t-this.lastTime)/1e3;this.world.step(this.fixedTimeStep,e,this.maxSubSteps),this.objectSync()}this.lastTime=t},this.timeInterval)}objectSync(){this.worldObjects.forEach(t=>{if(t.spark){const e=t.sync,r=e.properties,s=e.axes,o={};t.body.quaternion.toEuler(o),r.forEach(e=>{t.sync[e].enabled&&s.forEach(r=>{if(t.sync[e].allAxis||t.sync[e][r]){const s=`rotation${r.toUpperCase()}`;"position"==e&&(t.spark.transform[r]=t.body[e][r]),"rotation"==e&&(t.spark.transform[s]=o[r])}})})}})}stopSync(){this.currentInterval&&(this.Time.clearInterval(this.currentInterval),this.lastInterval=currentInterval,this.currentInterval=void 0),this.resetWorldState()}getDefaults(t){return t?this.defaults[t]:this.defaults}fillWithDefaults(t){const e=this.getDefaults();return Object.keys(e).forEach(r=>{t.hasOwnProperty(r)||(t[r]=e[r]),Object.keys(e[r]).forEach(s=>{Array.isArray(t[r][s])?e[r][s].forEach(o=>{t[r][s].indexOf(o)<0&&t[r][s].push(e[r][s][o])}):(t[r].hasOwnProperty(s)||(t[r][s]=e[r][s]),"object"!=typeof e[r][s]||Array.isArray(e[r][s])||Object.keys(e[r][s]).forEach(o=>{t[r][s].hasOwnProperty(o)||(t[r][s][o]=e[r][s][o])}))})}),t}resetWorldState(){this.initialWorldState&&this.worldObjects.forEach((t,e)=>{const r=this.initialWorldState[e],s=r.body,o=t.body;if(o.velocity.setZero(),o.initVelocity.setZero(),o.angularVelocity.setZero(),o.initAngularVelocity.setZero(),o.force.setZero(),o.torque.setZero(),o.quaternion=s.quaternion,o.position=s.position,t.spark){const e=t.sync,s=e.properties,o=e.axes,i={};t.body.quaternion.toEuler(i),s.forEach(e=>{t.sync[e].enabled&&o.forEach(s=>{if(t.sync[e].allAxis||t.sync[e][s]){const o=`rotation${s.toUpperCase()}`;"position"==e&&(t.spark.transform[s]=r.spark.transform[s]),"rotation"==e&&(t.spark.transform[o]=r.spark.transform[o])}})})}})}createObject(t,e,r){const{sync:s,body:o}=this.fillWithDefaults(r),{mass:i,radius:n,transform:a}=o,c=a.rotation,l=a.scale,u=a.position,d=new this.CANNON.Vec3(u.x,u.y,u.z),h=new this.CANNON.Quaternion(c.x,c.y,c.z,c.w),f=t=>{switch(t){case"box":return new this.CANNON.Box(new this.CANNON.Vec3(l.x,l.y,l.z));case"sphere":return new this.CANNON.Sphere(n);case"ground":return new this.CANNON.Plane}},y=t=>{const r={mass:i,shape:t,position:d,quaternion:h,angularDamping:.8};return"sphere"==e&&(r.radius=n),"ground"==e&&(r.mass=0),r},p=(t=>{const e=new this.CANNON.Body(y(f(t)));if("ground"==t){const t=-Math.PI/2,r=new this.CANNON.Vec3(1,0,0);e.quaternion.setFromAxisAngle(r,t)}return e})(e);this.addObjectToPhysicsWorld(p,t,s,"ground"==e)}log(t){this.Diagnostics.log(t)}addObjectToPhysicsWorld(t,e,r,s){this.world.addBody(t);const o={body:t,spark:e,sync:{...this.getDefaults("sync"),...r},isGround:s,id:((t,e)=>{for(e=t="";t++<36;e+=51*t&52?(15^t?8^Math.random()*(20^t?16:4):4).toString(16):"-");return e})()};return this.worldObjects.push(o),o}createCannonMaterial(t){let e=void 0;return null==t&&(e=new this.CANNON.Material),e}start(){this.beginSync()}}({x:0,y:-9.82,z:0});a.createObject(n,"ground",{body:{mass:0,transform:{position:{x:0,y:0,z:0}}}}),a.createObject(o,"sphere",{body:{mass:1,radius:.01,transform:{position:{x:0,y:2,z:0}}}}),a.createObject(i,"box",{body:{mass:5,transform:{scale:{x:.01,y:.01,z:.01},position:{x:0,y:10,z:0},rotation:{x:.2,y:.8,z:.3,w:0}}}}),a.start()}]);